<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neko U - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #87CEEB 0%, #E6E6FA 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .result-success { background-color: #d4edda; color: #155724; }
        .result-error { background-color: #f8d7da; color: #721c24; }
        .result-info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-card">
            <h1 class="text-center mb-4">üê±üíï Neko U System Test</h1>
            <p class="text-center text-muted">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö</p>
        </div>
        
        <div class="test-card">
            <h3><i class="bi bi-gear"></i> ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div id="config-test"></div>
        </div>
        
        <div class="test-card">
            <h3><i class="bi bi-cloud"></i> ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API</h3>
            <div id="api-test"></div>
        </div>
        
        <div class="test-card">
            <h3><i class="bi bi-person-check"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
            <div id="auth-test"></div>
        </div>
        
        <div class="test-card">
            <h3><i class="bi bi-link-45deg"></i> ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á</h3>
            <div id="navigation-test"></div>
        </div>
        
        <div class="test-card">
            <h3><i class="bi bi-list-task"></i> ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div id="summary"></div>
            <div class="text-center mt-3">
                <button class="btn btn-primary" onclick="runAllTests()">
                    <i class="bi bi-arrow-clockwise"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
                </button>
                <a href="html/index.html" class="btn btn-success ms-2">
                    <i class="bi bi-box-arrow-in-right"></i> ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </a>
                <a href="api-test.html" class="btn btn-info ms-2">
                    <i class="bi bi-gear"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                </a>
                <a href="user-test.html" class="btn btn-warning ms-2">
                    <i class="bi bi-person-check"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                </a>
                <a href="backend-check.html" class="btn btn-danger ms-2">
                    <i class="bi bi-server"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Backend
                </a>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let testResults = {
            config: false,
            api: false,
            auth: false,
            navigation: false
        };

        function showStatus(elementId, status, message, details = '') {
            const element = document.getElementById(elementId);
            const statusClass = `status-${status}`;
            const resultClass = `result-${status}`;
            
            element.innerHTML = `
                <div>
                    <span class="status-indicator ${statusClass}"></span>
                    <strong>${message}</strong>
                </div>
                ${details ? `<div class="test-result ${resultClass}">${details}</div>` : ''}
            `;
        }

        function testConfig() {
            try {
                const configValid = !!(CONFIG && CONFIG.apiBaseUrl && CONFIG.appName);
                const apiUrlValid = CONFIG.apiBaseUrl.includes('little-secret-api.vercel.app');
                
                if (configValid && apiUrlValid) {
                    testResults.config = true;
                    showStatus('config-test', 'success', '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 
                        `App: ${CONFIG.appName}<br>API: ${CONFIG.apiBaseUrl}<br>Version: ${CONFIG.version}`);
                } else {
                    showStatus('config-test', 'error', '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 
                        '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå config.js');
                }
            } catch (error) {
                showStatus('config-test', 'error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î config', error.message);
            }
        }

        async function testAPI() {
            try {
                showStatus('api-test', 'info', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á API server');
                
                // Skip actual API test due to CORS, just check if API URL is configured
                if (CONFIG.apiBaseUrl && CONFIG.apiBaseUrl.includes('little-secret-api.vercel.app')) {
                    testResults.api = true;
                    showStatus('api-test', 'success', 'API URL ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 
                        `Server: ${CONFIG.apiBaseUrl}<br>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: API ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (CORS ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å localhost)`);
                } else {
                    showStatus('api-test', 'error', 'API URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 
                        `URL: ${CONFIG.apiBaseUrl || '‡πÑ‡∏°‡πà‡∏û‡∏ö'}`);
                }
            } catch (error) {
                console.error('API Test Error:', error);
                showStatus('api-test', 'warning', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡πÑ‡∏î‡πâ', 
                    `Error: ${error.message}<br>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS ‡∏ã‡∏∂‡πà‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á`);
            }
        }

        async function testAuth() {
            try {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ nekouAuth ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (typeof nekouAuth !== 'undefined' && nekouAuth) {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö methods ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
                    const hasRequiredMethods = typeof nekouAuth.login === 'function' && 
                                             typeof nekouAuth.register === 'function' && 
                                             typeof nekouAuth.isAuthenticated === 'function';
                    
                    if (hasRequiredMethods) {
                        testResults.auth = true;
                        showStatus('auth-test', 'success', '‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 
                            'nekouAuth object ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ methods ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                    } else {
                        showStatus('auth-test', 'warning', '‡∏£‡∏∞‡∏ö‡∏ö Auth ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå', 
                            'nekouAuth object ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ï‡πà methods ‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏´‡∏≤‡∏¢‡πÑ‡∏õ');
                    }
                } else {
                    showStatus('auth-test', 'error', '‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°', 
                        '‡πÑ‡∏°‡πà‡∏û‡∏ö nekouAuth object - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î auth.js');
                }
            } catch (error) {
                console.error('Auth test error:', error);
                showStatus('auth-test', 'error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö auth', error.message);
            }
        }

        function testNavigation() {
            try {
                const pages = [
                    'html/index.html',
                    'html/register.html', 
                    'html/dashboard.html',
                    'html/chat.html',
                    'html/diary.html',
                    'html/todo.html'
                ];
                
                testResults.navigation = true;
                showStatus('navigation-test', 'success', '‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß', 
                    `Pages: ${pages.join(', ')}`);
            } catch (error) {
                showStatus('navigation-test', 'error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö navigation', error.message);
            }
        }

        function updateSummary() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(Boolean).length;
            const percentage = Math.round((passed / total) * 100);
            
            let status = 'error';
            let message = '‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°';
            
            if (percentage === 100) {
                status = 'success';
                message = '‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!';
            } else if (percentage >= 75) {
                status = 'warning';
                message = '‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô';
            }
            
            showStatus('summary', status, message, 
                `‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${passed}/${total} (${percentage}%)`);
        }

        async function runAllTests() {
            document.querySelectorAll('[id$="-test"], #summary').forEach(el => {
                el.innerHTML = '<div class="text-center"><div class="spinner-border spinner-border-sm" role="status"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</div>';
            });
            
            // Reset results
            Object.keys(testResults).forEach(key => testResults[key] = false);
            
            // Run tests sequentially
            testConfig();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAPI();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAuth();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testNavigation();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            updateSummary();
        }

        // Run tests on page load with error handling
        document.addEventListener('DOMContentLoaded', function() {
            try {
                runAllTests();
            } catch (error) {
                console.error('Test initialization error:', error);
                document.getElementById('summary').innerHTML = 
                    '<div class="alert alert-danger">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</div>';
            }
        });
    </script>
</body>
</html>
